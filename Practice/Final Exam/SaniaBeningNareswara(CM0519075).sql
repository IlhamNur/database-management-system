/*Sania Bening Nareswara - M0519075 - C*/

/* no 1 */
CREATE DATABASE mhs

use mhs
CREATE TABLE MAHASISWA(
	KdFakultas nchar(1) NOT NULL,
	KdProdi int NOT NULL,
	NamaKaprodi nvarchar(20) NOT NULL,
	KdAngkatan int NOT NULL,
	NoUrut int NOT NULL,
	Nim nvarchar(8) NOT NULL,
	Nama nvarchar(20) NOT NULL,
	NIDNDosenPA nvarchar(10) NOT NULL,
	NamaDosenPA nvarchar (20) NOT NULL,
	SKSTempuh int NOT NULL,
	SKSSemester int NOT NULL,
	IPK dec(3,2) NOT NULL,
	IPSmtAktif dec(3,2) NOT NULL,
	PRIMARY KEY (Nim)
);

INSERT INTO MAHASISWA VALUES ('M', 04, 'Dr. Widodo', 18, 01, 'M041801', 'Wawan', '0012109002', 'Dr. Waskito', 100, 23, '3.34', '3.27');
INSERT INTO MAHASISWA VALUES ('M', 05, 'Dr. Wiharto', 19, 02, 'M051902', 'Irwan', '0009097803', 'Dr. Umi', 67, 21, '3.10', '3.90');
INSERT INTO MAHASISWA VALUES ('M', 05, 'Dr. Wiharto', 18, 01, 'M051801', 'Bambang', '0009097803', 'Dr. Umi', 103, 20, '3.23', '3.73');
INSERT INTO MAHASISWA VALUES ('M', 06, 'Dr. Isnandar', 19, 02, 'M061902', 'Yahya', '00140467', 'Dr. Etik', 60, 23, '3.61', '3.30');
INSERT INTO MAHASISWA VALUES ('T', 01, 'Dr. Untung', 18, 01, 'T011801', 'Bekti', '00300189', 'Dr. Indira', 105, 20, '3.05', '3.19');
INSERT INTO MAHASISWA VALUES ('T', 02, 'Dr. Fery', 19, 02, 'T021902', 'Sayekti', '00270577', 'Dr. Suparjo', 66, 19, '3.37', '3.00');
INSERT INTO MAHASISWA VALUES ('K', 06, 'Dr. Muzzazinah', 18, 01, 'K061801', 'Witri', '00130579', 'Dr. Sumarno', 101, 21, '3.07', '3.00');
INSERT INTO MAHASISWA VALUES ('K', 07, 'Dr. Sri Mulyani', 19, 02, 'K071902', 'Ayu', '00190682', 'Dr. Respati', 69, 20, '3.11', '3.18');
INSERT INTO MAHASISWA VALUES ('H', 01, 'Dr. Rustamaji', 18, 01, 'H011801', 'Hanung', '00170481', 'Dr. Kamto', 98, 20, '3.50', '3.12');
INSERT INTO MAHASISWA VALUES ('H', 01, 'Dr. Rustamaji', 19, 02, 'H011902', 'Mulyono', '00170481', 'Dr. Kamto', 68, 23, '3.05', '3.20');
INSERT INTO MAHASISWA VALUES ('S', 01, 'Dr. Setyo Budi', 18, 01, 'S011801', 'Bambang', '00261084', 'Dr. Hartono', 102, 22, '3.00', '3.80');
INSERT INTO MAHASISWA VALUES ('S', 02, 'Dr. Widodo', 19, 02, 'S021902', 'Ningsih', '00110782', 'Dr. Waskito', 62, 18, '3.17', '3.00');

/* no 2 */
BACKUP DATABASE mhs
TO DISK = 'D:\backupdb\mhs.bak';

/* no 3 */
CREATE DATABASE MHSBARU;

use MHSBARU;
CREATE TABLE PRODI(
	KdFakultas nchar(1) NOT NULL,
	KdProdi int NOT NULL,
	NamaKaprodi nvarchar(20) NOT NULL,
	PRIMARY KEY(KdFakultas, KdProdi)
);
INSERT INTO PRODI VALUES ('M', 04, 'Dr. Widodo');
INSERT INTO PRODI VALUES ('M', 05, 'Dr. Wiharto');
INSERT INTO PRODI VALUES ('M', 05, 'Dr. Wiharto');
INSERT INTO PRODI VALUES ('M', 06, 'Dr. Isnandar');
INSERT INTO PRODI VALUES ('T', 01, 'Dr. Untung');
INSERT INTO PRODI VALUES ('T', 02, 'Dr. Fery');
INSERT INTO PRODI VALUES ('K', 06, 'Dr. Muzzazinah');
INSERT INTO PRODI VALUES ('K', 07, 'Dr. Sri Mulyani');
INSERT INTO PRODI VALUES ('H', 01, 'Dr. Rustamaji');
INSERT INTO PRODI VALUES ('H', 01, 'Dr. Rustamaji');
INSERT INTO PRODI VALUES ('S', 01, 'Dr. Setyo Budi');
INSERT INTO PRODI VALUES ('S', 02, 'Dr. Widodo');

CREATE TABLE DOSENPA(
	NIDNDosenPA nvarchar(10) NOT NULL,
	NamaDosenPA nvarchar (20) NOT NULL,
	PRIMARY KEY(NIDNDosenPA)
);

INSERT INTO DOSENPA VALUES ('0012109002', 'Dr. Waskito');
INSERT INTO DOSENPA VALUES ('0009097803', 'Dr. Umi');
INSERT INTO DOSENPA VALUES ('0009097803', 'Dr. Umi');
INSERT INTO DOSENPA VALUES ('00140467', 'Dr. Etik');
INSERT INTO DOSENPA VALUES ('00300189', 'Dr. Indira');
INSERT INTO DOSENPA VALUES ('00270577', 'Dr. Suparjo');
INSERT INTO DOSENPA VALUES ('00130579', 'Dr. Sumarno');
INSERT INTO DOSENPA VALUES ('00190682', 'Dr. Respati');
INSERT INTO DOSENPA VALUES ('00170481', 'Dr. Kamto');
INSERT INTO DOSENPA VALUES ('00170481', 'Dr. Kamto');
INSERT INTO DOSENPA VALUES ('00261084', 'Dr. Hartono');
INSERT INTO DOSENPA VALUES ('00110782', 'Dr. Waskito');

CREATE TABLE NIMMHS(
	Nim nvarchar(8) NOT NULL,
	KdFakultas nchar(1) NOT NULL,
	KdProdi int NOT NULL,
	KdAngkatan int NOT NULL,
	NoUrut int NOT NULL,
	PRIMARY KEY (Nim)
);

INSERT INTO NIMMHS VALUES ('M041801', 'M', 04, 18, 01);
INSERT INTO NIMMHS VALUES ('M051902', 'M', 05, 19, 02);
INSERT INTO NIMMHS VALUES ('M051801', 'M', 05, 18, 01);
INSERT INTO NIMMHS VALUES ('M061902', 'M', 06, 19, 02);
INSERT INTO NIMMHS VALUES ('T011801', 'T', 01, 18, 01);
INSERT INTO NIMMHS VALUES ('T021902', 'T', 02, 19, 02);
INSERT INTO NIMMHS VALUES ('K061801', 'K', 06, 18, 01);
INSERT INTO NIMMHS VALUES ('K071902', 'K', 07, 19, 02);
INSERT INTO NIMMHS VALUES ('H011801', 'H', 01, 18, 01);
INSERT INTO NIMMHS VALUES ('H011902', 'H', 01, 19, 02);
INSERT INTO NIMMHS VALUES ('S011801', 'S', 01, 18, 01);
INSERT INTO NIMMHS VALUES ('S021902', 'S', 02, 19, 02);

CREATE TABLE MHS(
	Nim nvarchar(8) NOT NULL,
	Nama nvarchar(20) NOT NULL,
	SKSTempuh int NOT NULL,
	SKSSemester int NOT NULL,
	IPSemesterAktif dec(3,2) NOT NULL,
	IPK dec(3,2) NOT NULL,
	NIDNDosenPA nvarchar(10) NOT NULL,
	PRIMARY KEY (Nim),
	FOREIGN KEY (NIDNDosenPA) REFERENCES DOSENPA(NIDNDosenPA)
);

INSERT INTO MHS VALUES ('M041801', 'Wawan', 100, 23, '3.27', '3.34', '0012109002');
INSERT INTO MHS VALUES ('M051902', 'Irwan', 67, 21, '3.90', '3.10', '0009097803');
INSERT INTO MHS VALUES ('M051801', 'Bambang', 103, 20, '3.73', '3.23', '0009097803');
INSERT INTO MHS VALUES ('M061902', 'Yahya', 60, 23, '3.30', '3.61', '00140467');
INSERT INTO MHS VALUES ('T011801', 'Bekti', 105, 20, '3.19', '3.05', '00300189');
INSERT INTO MHS VALUES ('T021902', 'Sayekti', 66, 19, '3.00', '3.37', '00270577');
INSERT INTO MHS VALUES ('K061801', 'Witri', 101, 21, '3.00', '3.07', '00130579');
INSERT INTO MHS VALUES ('K071902', 'Ayu', 69, 20, '3.18', '3.11', '00190682');
INSERT INTO MHS VALUES ('H011801', 'Hanung', 98, 20, '3.12', '3.50', '00170481');
INSERT INTO MHS VALUES ('H011902', 'Mulyono', 68, 23, '3.20', '3.05', '00170481');
INSERT INTO MHS VALUES ('S011801', 'Bambang', 102, 22, '3.80', '3.00', '00261084');
INSERT INTO MHS VALUES ('S021902', 'Ningsih', 62, 18, '3.00', '3.17', '00110782');

/* no 4 */
use mhs
CREATE PROCEDURE dbo.newMAHASISWA	@KdFakultas nchar(1),
	@KdProdi int,
	@KdAngkatan int,
	@NoUrut int
	AS
	BEGIN
	INSERT INTO MAHASISWA
	VALUES (@KdFakultas, @KdProdi, @KdAngkatan, @NoUrut);
	END;

EXEC dbo.newnewMAHASISWA 'M', 05, 19, 075;

/* no 5 */
use mhs
CREATE INDEX KdFakultas ON MAHASISWA(KdFakultas);
CREATE INDEX KdProdi ON MAHASISWA(KdProdi);
CREATE INDEX NamaKaprodi ON MAHASISWA(NamaKaprodi);
CREATE INDEX KdAngkatan ON MAHASISWA(KdAngkatan);
CREATE INDEX NoUrut ON MAHASISWA(NoUrut);
CREATE INDEX Nim ON MAHASISWA(Nim);
CREATE INDEX Nama ON MAHASISWA(Nama);
CREATE INDEX NIDNDosenPA ON MAHASISWA(NIDNDosenPA);
CREATE INDEX NamaDosenPA ON MAHASISWA(NamaDosenPA);
CREATE INDEX SKSTempuh ON MAHASISWA(SKSTempuh);
CREATE INDEX SKSSemester ON MAHASISWA(SKSSemester);
CREATE INDEX IPK ON MAHASISWA(IPK);
CREATE INDEX IPSmtAktif ON MAHASISWA(IPSmtAktif);

/* no 6 */
/*a*/
use mhs
SELECT AVG(IPK) 'Rata-Rata IPK'
FROM MAHASISWA;

/*b*/
SELECT TOP(1) Nama, IPK
FROM MAHASISWA
ORDER BY IPK DESC;

/*c*/
SELECT Nim, Nama, IPK
FROM MAHASISWA;

/*d*/
SELECT TOP(1) NamaKaprodi
FROM MAHASISWA
ORDER BY IPK DESC;

/*e*/
SELECT Nama, NamaDosenPA
FROM MAHASISWA
WHERE LEN(Nama) = LEN(NamaDosenPA);